<!DOCTYPE html> <html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="description" content="Tizen basic template generated by Tizen Web IDE"/>

    <title>Tizen Web IDE - Tizen - Tizen basic Application</title>

    <script src="tizen-web-ui-fw/latest/js/jquery.js"></script>
    <script src="tizen-web-ui-fw/latest/js/tizen-web-ui-fw-libs.js"></script>
    <script src="tizen-web-ui-fw/latest/js/tizen-web-ui-fw.js"
        data-framework-theme="tizen-black" data-framework-viewport-scale="false"></script>

    <script src="js/meecast.js"></script>
    <link rel="stylesheet" type="text/css" href="css/style.css"/>

    <script type="text/javascript">


     function _currentstationname_js(){
        var current_station_name = Module.cwrap('current_station_name', 'string', []);
        document.getElementById('main_station_name').innerHTML = current_station_name();
     };


     function _create_sources_list_js(){
        var create_sources_list = Module.cwrap('create_sources_list', 'string', []);
        Module.print("Data!!!!! :" + create_sources_list());
        var data = JSON.parse(create_sources_list());
        var text = "";
        for (var i in data) {
            text = text + " <li id=\"" + data[i] + "\"  data-icon=\"arrow-r\" data-iconpos=\"right\" ><a  href=\"javascript:countries_page('"+ data[i] + "');\">" + data[i] + "</a></li>";
            //text = text + " <li id=\"" + data[i] + "\"  data-icon=\"arrow-r\" data-iconpos=\"right\" ><a  href=\"javascript:countries_page(\"" + data[i] + "\");\">" + data[i] + "</a></li>";
//            text = text + " <li id=\"" + data[i] + "\"  data-icon=\"arrow-r\" data-iconpos=\"right\" ><a  href=\"manage_country.html\">" + data[i] + "</a></li>";
        }
              Module.print("List" + text);
        return text;
    }


     function  _prepare_database_js(database_name){

        var WidgetDir;
        var ConfigFile;
        var DBFileFS;
        
        try {
            tizen.filesystem.resolve('wgt-package',
             function(dir){
                WidgetDir = dir;
                Module.print('\'wgt-package\' resolved ' + WidgetDir);

                    // Check file in original path 
                    ret = FS.analyzePath(database_name);
                    if (ret.exists) {
                        Module.print('Original database file is done');
                        $.mobile.changePage('manage_country.html'); //Change page view
                        return;
                    }

                    try {
                        Module.print("Dir path " + dir.path + " Database name " + database_name);
                        DBFile = dir.resolve('WebContent/' + database_name);

                        try {
                            DBFile.openStream(
                                'r',
                                function(fileStream) {
                                    var contents = fileStream.readBytes(fileStream.bytesAvailable);
                                    DBFileFS = FS.createDataFile('/', database_name, contents, true, true);
                                    fileStream.close();
                                    Module.print('Database file is done');
                                    $.mobile.changePage('manage_country.html'); //Change page view
                                },
                                function(e){
                                    Module.print("Error" + e.message);
                                }
                            );
                        } catch (exc){
                            Module.print('read() exception:' + exc.message);
                        }
                    } catch (exc){
                        Module.print('Not resolve database file  ' + exc.message + '<br/>');
                    }
            },
             function(e){
                Module.print("Error" + e.message);
             } ,
             'r');
        } catch (exc) {
            Module.print('tizen.filesystem.resolve() exception: ' + exc.message + '<br/>');
         } 
    }


        var gList = "";
        var current_database = "";
        $(document).delegate(
                "#main","pageinit", 
                 function() {
                    _currentstationname_js();
                 });
        $(document).delegate(
                "#manage_locations","pageinit", function() {
	                $("#manage_locations").bind("pagebeforeshow", function() {
                    gList = _create_sources_list_js();
                    //$("#location_manager_listview").listview("refresh");
                    $("#location_manager_listview").html(gList).trigger("create").listview("refresh");
                 });
                 });
        $(document).delegate(
                "#manage_countries","pageinit", function() {
	                $("#manage_countries").bind("pagebeforeshow", function() {
                    gList = _create_countries_list_js();
                    //$("#location_manager_listview").listview("refresh");
                    $("#countries_manager_listview").html(gList).trigger("create").listview("refresh");
                 });
                 });

    </script>

    <script type="text/javascript">
        function countries_page(sel_database){
            current_database = sel_database + ".db";
            _prepare_database_js(current_database); 
            //$.mobile.changePage('manage_country.html'); //Change page view
        }
    </script>

</head>

<body>
     <div data-role="page" id="main">
        <div data-role="header" data-position="fixed" data-id="foo">
            <h1><div id="main_station_name" style="font-family: courier new,courier,monospace;"></div>
            </h1>
        </div><!-- /header -->

        <div data-role="content">
         <button onclick="_currentstationname_js()" > Test</button>
        </div><!-- /content -->

        <div data-role="footer" data-position="fixed" data-id="foo1">
            <div data-role="controlbar" data-style="tabbar">
                <ul>
                    <li><a href="index.html" data-icon="ctrlbar-playlists" class="ui-btn-active ui-state-persist">Play List</a></li>
                    <li><a href="javascript:countries_page();" data-icon="ctrlbar-music_albums">Music</a></li>
                    <li><a href="settings_menu.html" data-icon="ctrlbar-artist">Menu</a></li>
                </ul>
            </div><!-- /navbar -->
        </div><!-- /footer -->
    </div><!-- /page -->


</body>
</html>
